{"ast":null,"code":"import _slicedToArray from\"C:/Users/basti/Documents/MyDigitalSchool/React/MDS-B3-2023-Food-Delivery/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:/Users/basti/Documents/MyDigitalSchool/React/MDS-B3-2023-Food-Delivery/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/basti/Documents/MyDigitalSchool/React/MDS-B3-2023-Food-Delivery/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/basti/Documents/MyDigitalSchool/React/MDS-B3-2023-Food-Delivery/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect}from'react';import{login as _login,register as _register}from'../services/Api';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/React.createContext();var actionTypes={LOGIN_SUCCESS:'LOGIN_SUCCESS',LOGIN_FAILURE:'LOGIN_FAILURE',LOADING:'LOADING',LOGOUT:'LOGOUT',REGISTER_SUCESS:'REGISTER_SUCESS',REGISTER_FAILURE:'REGISTER_FAILURE'};var initialState={isAuthenticated:false,token:null,user:null,loading:false,error:null};var AuthReducer=function AuthReducer(state,action){switch(action.type){case actionTypes.LOGIN_SUCCESS:return{isAuthenticated:true,token:action.data.jwt,user:action.data.user,loading:false,error:null};case actionTypes.REGISTER_SUCESS:return{isAuthenticated:true,token:action.data.jwt,user:action.data.user,loading:false,error:null};case actionTypes.LOGIN_FAILURE:return _objectSpread(_objectSpread({},initialState),{},{error:action.data.error});case actionTypes.REGISTER_FAILURE:return _objectSpread(_objectSpread({},initialState),{},{error:action.data.error});case actionTypes.LOADING:return _objectSpread(_objectSpread({},state),{},{loading:true});case actionTypes.LOGOUT:return initialState;default:throw new Error(\"Unhandled action type : \".concat(action.type));}};var AuthContextFactory=function AuthContextFactory(dispatch){return{login:function(){var _login2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(credentials){var result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _login(credentials);case 3:result=_context.sent;toast.success(\"Wesh fr\\xE9ro \".concat(result.user.username,\", koi de neuf mageule  sa va ou koi ! \"));dispatch({type:actionTypes.LOGIN_SUCCESS,data:result});_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);toast.error('Identifiant ou mot de passe invalide ');dispatch({type:actionTypes.LOGIN_FAILURE,data:{error:_context.t0}});case 12:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));function login(_x){return _login2.apply(this,arguments);}return login;}(),register:function(){var _register2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(usersInfos){var result;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _register(usersInfos);case 3:result=_context2.sent;toast.success(\"T'es INSCRIT fréro, bien joué t'es un bon TOI ! \");dispatch({type:actionTypes.LOGIN_SUCCESS,data:result});_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);toast.error('Les informations saisie son incorrecte ! FREROOOOO ');dispatch({type:actionTypes.REGISTER_FAILURE,data:{error:_context2.t0}});case 12:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));function register(_x2){return _register2.apply(this,arguments);}return register;}(),logout:function logout(){toast.warn('Déconnexion ...');dispatch({type:actionTypes.LOGOUT});}};};var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var savedState=window.localStorage.getItem('AUTH');var _initialState=savedState?JSON.parse(savedState):initialState;var _React$useReducer=React.useReducer(AuthReducer,_initialState),_React$useReducer2=_slicedToArray(_React$useReducer,2),state=_React$useReducer2[0],dispatch=_React$useReducer2[1];useEffect(function(){window.localStorage.setItem('AUTH',JSON.stringify(state));},[state]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(AuthContext.Provider,{value:_objectSpread({state:state},AuthContextFactory(dispatch)),children:children})});};var useAuth=function useAuth(){var context=React.useContext(AuthContext);if(!context)throw new Error('use Auth must be used inside a AuthProvider');return context;};export{AuthProvider,useAuth};","map":{"version":3,"names":["React","useEffect","login","register","toast","AuthContext","createContext","actionTypes","LOGIN_SUCCESS","LOGIN_FAILURE","LOADING","LOGOUT","REGISTER_SUCESS","REGISTER_FAILURE","initialState","isAuthenticated","token","user","loading","error","AuthReducer","state","action","type","data","jwt","Error","AuthContextFactory","dispatch","credentials","result","success","username","usersInfos","logout","warn","AuthProvider","children","savedState","window","localStorage","getItem","_initialState","JSON","parse","useReducer","setItem","stringify","useAuth","context","useContext"],"sources":["C:/Users/basti/Documents/MyDigitalSchool/React/MDS-B3-2023-Food-Delivery/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { useEffect } from 'react'\r\nimport { login, register } from '../services/Api'\r\nimport { toast } from 'react-toastify'\r\n\r\nconst AuthContext = React.createContext()\r\n\r\nconst actionTypes = {\r\n  LOGIN_SUCCESS: 'LOGIN_SUCCESS',\r\n  LOGIN_FAILURE: 'LOGIN_FAILURE',\r\n  LOADING: 'LOADING',\r\n  LOGOUT: 'LOGOUT',\r\n  REGISTER_SUCESS: 'REGISTER_SUCESS',\r\n  REGISTER_FAILURE: 'REGISTER_FAILURE'\r\n\r\n}\r\n\r\nconst initialState = {\r\n  isAuthenticated: false,\r\n  token: null,\r\n  user: null,\r\n  loading: false,\r\n  error: null\r\n}\r\n\r\nconst AuthReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case actionTypes.LOGIN_SUCCESS:\r\n      return {\r\n        isAuthenticated: true,\r\n        token: action.data.jwt,\r\n        user: action.data.user,\r\n        loading: false,\r\n        error: null\r\n      }\r\n    case actionTypes.REGISTER_SUCESS:\r\n      return {\r\n        isAuthenticated: true,\r\n        token: action.data.jwt,\r\n        user: action.data.user,\r\n        loading: false,\r\n        error: null\r\n      }\r\n    case actionTypes.LOGIN_FAILURE:\r\n      return {\r\n        ...initialState,\r\n        error: action.data.error\r\n      }\r\n    case actionTypes.REGISTER_FAILURE:\r\n      return {\r\n        ...initialState,\r\n        error: action.data.error\r\n      }\r\n    case actionTypes.LOADING:\r\n      return {\r\n        ...state,\r\n        loading: true\r\n      }\r\n    case actionTypes.LOGOUT:\r\n      return initialState\r\n\r\n    default:\r\n      throw new Error(`Unhandled action type : ${action.type}`)\r\n  }\r\n}\r\nconst AuthContextFactory = (dispatch) => ({\r\n  login: async (credentials) => {\r\n    try {\r\n      const result = await login(credentials)\r\n      toast.success(`Wesh fréro ${result.user.username}, koi de neuf mageule  sa va ou koi ! `)\r\n      dispatch({\r\n        type: actionTypes.LOGIN_SUCCESS,\r\n        data: result\r\n      })\r\n    } catch (error) {\r\n      toast.error('Identifiant ou mot de passe invalide ')\r\n      dispatch({\r\n        type: actionTypes.LOGIN_FAILURE,\r\n        data: { error }\r\n      })\r\n    }\r\n  },\r\n\r\n  register: async (usersInfos) => {\r\n    try {\r\n      const result = await register(usersInfos)\r\n      toast.success(\"T'es INSCRIT fréro, bien joué t'es un bon TOI ! \")\r\n      dispatch({\r\n        type: actionTypes.LOGIN_SUCCESS,\r\n        data: result\r\n      })\r\n    } catch (error) {\r\n      toast.error('Les informations saisie son incorrecte ! FREROOOOO ')\r\n      dispatch({\r\n        type: actionTypes.REGISTER_FAILURE,\r\n        data: { error }\r\n      })\r\n    }\r\n  },\r\n  logout: () => {\r\n    toast.warn('Déconnexion ...')\r\n    dispatch({\r\n      type: actionTypes.LOGOUT\r\n    })\r\n  }\r\n})\r\n\r\nconst AuthProvider = ({ children }) => {\r\n  const savedState = window.localStorage.getItem('AUTH')\r\n  const _initialState = savedState ? JSON.parse(savedState) : initialState\r\n  const [state, dispatch] = React.useReducer(AuthReducer, _initialState)\r\n\r\n  useEffect(() => {\r\n    window.localStorage.setItem('AUTH', JSON.stringify(state))\r\n  }, [state])\r\n  return (\r\n    <>\r\n      <AuthContext.Provider value={{ state, ...AuthContextFactory(dispatch) }}>\r\n        {children}\r\n      </AuthContext.Provider>\r\n    </>\r\n  )\r\n}\r\n\r\nconst useAuth = () => {\r\n  const context = React.useContext(AuthContext)\r\n  if (!context) throw new Error('use Auth must be used inside a AuthProvider')\r\n  return context\r\n}\r\n\r\nexport {\r\n  AuthProvider,\r\n  useAuth\r\n\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}